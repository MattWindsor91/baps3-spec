<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Protocol | BAPS3 Specification</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="../../comms/internal/features.html" />
    
    
    <link rel="prev" href="../../comms/internal/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../../gitbook/style.css">


        
    <div class="book" data-level="4.1.1" data-basepath="../.." data-revision="1419896098637">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="meta/README.html">
            
                
                    <a href="../../meta/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         This document
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="meta/compiling.html">
            
                
                    <a href="../../meta/compiling.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Compiling
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="meta/conventions.html">
            
                
                    <a href="../../meta/conventions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Conventions
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.3" data-path="meta/terminology.html">
            
                
                    <a href="../../meta/terminology.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                         Terminology
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="rationale/README.html">
            
                
                    <a href="../../rationale/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Rationale
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="services/README.html">
            
                
                    <a href="../../services/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Services
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="services/rationale.html">
            
                
                    <a href="../../services/rationale.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Rationale
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="services/player.html">
            
                
                    <a href="../../services/player.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         Player
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="services/playlist.html">
            
                
                    <a href="../../services/playlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         Playlist
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4" data-path="services/platform.html">
            
                
                    <a href="../../services/platform.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                         Platform
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.5" data-path="services/tracklister.html">
            
                
                    <a href="../../services/tracklister.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                         Track Lister
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.6" data-path="services/trackresolver.html">
            
                
                    <a href="../../services/trackresolver.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                         Track Resolver
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.7" data-path="services/client.html">
            
                
                    <a href="../../services/client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                         Client
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.8" data-path="services/additional.html">
            
                
                    <a href="../../services/additional.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                         Additional Services
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="comms/README.html">
            
                
                    <a href="../../comms/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Inter-Service Communications
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="comms/internal/README.html">
            
                
                    <a href="../../comms/internal/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Internal API
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="4.1.1" data-path="comms/internal/protocol.html">
            
                
                    <a href="../../comms/internal/protocol.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.</b>
                        
                         Protocol
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.2" data-path="comms/internal/features.html">
            
                
                    <a href="../../comms/internal/features.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.2.</b>
                        
                         Features
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.3" data-path="comms/internal/changes.html">
            
                
                    <a href="../../comms/internal/changes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.3.</b>
                        
                         API Changes
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.4" data-path="comms/internal/core.html">
            
                
                    <a href="../../comms/internal/core.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.4.</b>
                        
                         Core
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.5" data-path="comms/internal/feature-fileload.html">
            
                
                    <a href="../../comms/internal/feature-fileload.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.5.</b>
                        
                         Feature: FileLoad
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.6" data-path="comms/internal/feature-playstop.html">
            
                
                    <a href="../../comms/internal/feature-playstop.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.6.</b>
                        
                         Feature: PlayStop
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.7" data-path="comms/internal/feature-seek.html">
            
                
                    <a href="../../comms/internal/feature-seek.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.7.</b>
                        
                         Feature: Seek
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.8" data-path="comms/internal/feature-end.html">
            
                
                    <a href="../../comms/internal/feature-end.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.8.</b>
                        
                         Feature: End
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.9" data-path="comms/internal/feature-timereport.html">
            
                
                    <a href="../../comms/internal/feature-timereport.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.9.</b>
                        
                         Feature: TimeReport
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.10" data-path="comms/internal/feature-playlist.html">
            
                
                    <a href="../../comms/internal/feature-playlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.10.</b>
                        
                         Feature: Playlist
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.11" data-path="comms/internal/feature-autoadvance.html">
            
                
                    <a href="../../comms/internal/feature-autoadvance.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.11.</b>
                        
                         Feature: Playlist.AutoAdvance
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.12" data-path="comms/internal/feature-textitems.html">
            
                
                    <a href="../../comms/internal/feature-textitems.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.12.</b>
                        
                         Feature: Playlist.TextItems
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="comms/external/README.html">
            
                
                    <a href="../../comms/external/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         External API
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="impl/README.html">
            
                
                    <a href="../../impl/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Reference Implementations
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >BAPS3 Specification</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_16">
                    
                        <h1 id="protocol">Protocol</h1>
<p>The BAPS3 Internal API sits atop a text-based protocol based upon
<a href="http://pubs.opengroup.org/onlinepubs/009604599/utilities/xcu_chap02.html" target="_blank">POSIX shell</a> conventions.</p>
<h2 id="rationale">Rationale</h2>
<p>We use a shell-style protocol because:</p>
<ul>
<li>It is lightweight and relatively easy to parse;</li>
<li>It is a good match for the command-and-arguments style of the BAPS3 API;</li>
<li>The shell style of escaping is convenient for escaping paths (especially on
Windows, where the single-quote syntax can avoid needing to escape every
backslash in a Windows path), which are common arguments to BAPS3 commands
(<code>load</code>, <code>enqueue</code>, and so on).</li>
</ul>
<p>A disadvantage is that it is impossible to perform a context-free splitting of
input into lines; the line-feed character could be escaped.  However, since the
usual transport used by the BAPS3 protocol is TCP, and most TCP libraries
provide unbuffered input in chunks which may be smaller or larger than one line,
we rarely need this luxury.</p>
<h2 id="encoding">Encoding</h2>
<p>The internal API is designed to expect requests and responses in the <a href="http://www.ietf.org/rfc/rfc3629.txt" target="_blank">UTF-8</a>
encoding.  However, to allow simple implementations that operate on a per-byte
level, certain uses of UTF-8 beyond the single-byte (ASCII) range are
discouraged.</p>
<p>API users <strong>must</strong> support the sending and receiving of all single-byte UTF-8
character codes (that is, ASCII), and <strong>should</strong> support the sending and
receiving of the full UTF-8 range subject to the limitations below.</p>
<h3 id="limitations">Limitations</h3>
<p>It is <em>undefined behaviour</em> to:</p>
<ul>
<li>Use a whitespace character not in the single-byte subset of UTF-8 to separate
words.  (See below for recommendations on word-separating whitespace.)  This
limitation allows implementations to make use of single-byte whitespace
checks for word separation;</li>
<li>Backslash-escape a character not in single-byte UTF-8.  (This should not be
necessary, as single- and double-quote modes will allow these characters to
be used without escape.)  This limitation allows backslash escaping to
operate on a single-byte level;</li>
<li>Backslash-escape the line-feed character.  This limitation is due to the
special status of line-feed escaping as line continuation in shell
tokenisation, and may change in future when a decision is made as to the
necessity of keeping this status in the API.</li>
</ul>
<p>API users <strong>may</strong> make decisions as to how to interpret said undefined
behaviour, but <strong>should not</strong> expect certain behaviour from other users without
consulting the <code>FEATURES</code> flags and <code>OHAI</code> response for confirmation of said
behaviour.</p>
<h2 id="quoting-and-escaping">Quoting and Escaping</h2>
<p>Most characters may be transmitted verbatim via the protocol.  However, in order
to allow separation of protocol communications into the <em>words</em> and <em>commands</em>
defined below, BAPS3 gives special meaning to certain characters.  This is
done according to four <em>quote modes</em>, specified below.</p>
<p><strong>Note:</strong> In case of ambiguity, refer to the <a href="http://pubs.opengroup.org/onlinepubs/009604599/utilities/xcu_chap02.html" target="_blank">POSIX shell</a> quoting standards:
we follow that style of quoting with the exception of disallowing variable and
command interpolation (thus, backtick and dollar are not considered special).</p>
<h3 id="unquoted-mode">Unquoted mode</h3>
<p>A protocol tokeniser <strong>should</strong> start in <em>unquoted</em> mode.  In this mode:</p>
<ul>
<li>Any run of <em>whitespace characters</em> (see below) separates one word from the next;</li>
<li>A <em>line-feed</em> character (<code>0x0A</code>) separates one command from the next, and
ends any word preceding;</li>
<li>A single-quote character (<code>&#39;</code>) begins <em>single-quoted</em> mode;</li>
<li>A double-quote character (<code>&quot;</code>) begins <em>double-quoted</em> mode;</li>
<li>A backslash character (<code>\</code>) begins <em>escaped</em> mode;</li>
<li>Any other character is echoed verbatim.</li>
</ul>
<h4 id="whitespace">Whitespace</h4>
<p>The whitespace characters permitted for word separation <strong>must not</strong> contain
line-feed (<code>0x0A</code>), and <strong>must</strong> contain space (<code>0x20</code>) and horizontal tab
(<code>0x09</code>).  Consequently, API users <strong>should</strong> use the latter two characters for
word separation.  API users <strong>should not</strong> use multi-byte whitespace
characters, for the reasons provided in <em>Encoding</em>.</p>
<p>For implementations in C or C++, the C function <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/isspace.html" target="_blank">isspace()</a> <strong>may</strong> be used
to identify word-separating whitespace, so long as line-feed is not interpreted
as such.</p>
<h3 id="single-quoted-mode">Single-quoted mode</h3>
<p>In single-quoted mode, only the single-quote character is treated specially, and
has the effect of returning to unquoted mode.</p>
<h3 id="double-quoted-mode">Double-quoted mode</h3>
<p>In double-quoted mode:</p>
<ul>
<li>A backslash character begins escaped mode;</li>
<li>A double-quote character begins unquoted mode;</li>
<li>Any other character is echoed verbatim.</li>
</ul>
<h3 id="escaped-mode">Escaped mode</h3>
<p>In escaped mode, any single character is treated verbatim; the mode then reverts
to that in which the backslash beginning escaped mode was read.</p>
<p>To allow implementations which escape single bytes instead of characters,
clients <strong>should not</strong> expect servers to backslash-escape multiple-byte
characters properly, and <strong>should</strong> instead use single-quoted or double-quoted
mode to escape these characters.</p>
<h2 id="words">Words</h2>
<p>The core element of the protocol is the <em>word</em>, which is a sequence of
zero or more characters delimited by any run of <em>unquoted</em> whitespace.</p>
<p><strong>Note:</strong> There is <em>no</em> limit on the number of quote mode transitions inside a
single word.  For example, <code>unquoted&quot;double&quot;unquoted&#39;single&#39;\ unquoted</code>
<strong>should</strong> be considered one word (albeit a pathological one).</p>
<h2 id="commands">Commands</h2>
<p>Each communication over the Internal API consists of a <em>command</em> of one or more
words.  The first, mandatory, word is the <em>command word</em> and unambiguously
identifies the command; any further words are <em>arguments</em> to that command.  In
this respect, the BAPS3 protocol perfectly mirrors shell usage.</p>
<p>Commands are divided into <em>requests</em> and <em>responses</em>.</p>
<h3 id="requests">Requests</h3>
<p><em>Requests</em> are the subset of valid commands that originate from an API client,
and instruct an API service.  Request command words <strong>should</strong> consist of one
or more <em>lowercase</em> ASCII characters, and <strong>may</strong> be quoted.</p>
<h3 id="responses">Responses</h3>
<p><em>Requests</em> are the subset of valid commands that originate from an API service,
and inform an API client.  Response command words <strong>should</strong> consist of one
or more <em>uppercase</em> ASCII characters, and <strong>may</strong> be quoted.</p>
<h3 id="examples">Examples</h3>
<p>The following are well-formed commands:</p>
<ul>
<li><code>stop</code></li>
<li><code>&quot;play&quot;</code></li>
<li><code>&#39;quit&#39;</code></li>
<li><code>enqueue file 0 /home/demo/music/test\ file.mp3</code></li>
<li><code>load &quot;/home/demo/music/test file.mp3&quot;</code></li>
<li><code>load &#39;C:\Users\Demo\Music\test file.mp3&#39;</code></li>
<li><code>load &quot;C:\\Users\\Demo\\Music\\test file.mp3&quot;</code></li>
<li><code>OHAI &#39;listmaster/playslave&#39;</code></li>
<li><code>FEATURES FileLoad PlayStop Seek End TimeReport</code></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../comms/internal/README.html" class="navigation navigation-prev " aria-label="Previous page: Internal API"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../comms/internal/features.html" class="navigation navigation-next " aria-label="Next page: Features"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
