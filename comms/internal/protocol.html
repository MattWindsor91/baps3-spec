<!DOCTYPE HTML>
<html lang="en-US" manifest="../../manifest.appcache">
    
    <head>
        
        <meta charset="UTF-8">
        <title>Protocol | BAPS3 Specification</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 0.7.1">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../../comms/internal/features.html" />
    
    
    <link rel="prev" href="../../comms/internal/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../../gitbook/style.css">


        
    <div class="book"  data-level="4.1.1" data-basepath="../.." data-revision="1408576010660">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../../" >BAPS3 Specification</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        

        
        
        <li>
            <a href="https://github.com/UniversityRadioYork/baps3-spec/issues" target="blank" class="issues-link">Questions and Issues</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/UniversityRadioYork/baps3-spec" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

	
	
	    
	     <li> 
	         <a href="https://ury.org.uk" target="blank" class="custom-link">URY</a>
             </li>
	
	

        
        <li class="divider"></li>
        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="meta/README.html">
            
                
                    <a href="../../meta/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         This document
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="meta/compiling.html">
            
                
                    <a href="../../meta/compiling.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Compiling
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="meta/conventions.html">
            
                
                    <a href="../../meta/conventions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Conventions
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="rationale/README.html">
            
                
                    <a href="../../rationale/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Rationale
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="services/README.html">
            
                
                    <a href="../../services/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Services
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="services/player.html">
            
                
                    <a href="../../services/player.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Player
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="services/playlist.html">
            
                
                    <a href="../../services/playlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         Playlist
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="services/platform.html">
            
                
                    <a href="../../services/platform.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         Platform
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4" data-path="services/tracklister.html">
            
                
                    <a href="../../services/tracklister.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                         Track Lister
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.5" data-path="services/trackresolver.html">
            
                
                    <a href="../../services/trackresolver.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                         Track Resolver
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.6" data-path="services/client.html">
            
                
                    <a href="../../services/client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                         Client
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.7" data-path="services/additional.html">
            
                
                    <a href="../../services/additional.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                         Additional Services
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="comms/README.html">
            
                
                    <a href="../../comms/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Inter-Service Communications
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="comms/internal/README.html">
            
                
                    <a href="../../comms/internal/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Internal API
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="4.1.1" data-path="comms/internal/protocol.html">
            
                
                    <a href="../../comms/internal/protocol.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.</b>
                        
                         Protocol
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.2" data-path="comms/internal/features.html">
            
                
                    <a href="../../comms/internal/features.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.2.</b>
                        
                         Features
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.3" data-path="comms/internal/changes.html">
            
                
                    <a href="../../comms/internal/changes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.3.</b>
                        
                         API Changes
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.4" data-path="comms/internal/core.html">
            
                
                    <a href="../../comms/internal/core.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.4.</b>
                        
                         Core
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.5" data-path="comms/internal/feature-fileload.html">
            
                
                    <a href="../../comms/internal/feature-fileload.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.5.</b>
                        
                         Feature: FileLoad
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.6" data-path="comms/internal/feature-playstop.html">
            
                
                    <a href="../../comms/internal/feature-playstop.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.6.</b>
                        
                         Feature: PlayStop
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.7" data-path="comms/internal/feature-seek.html">
            
                
                    <a href="../../comms/internal/feature-seek.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.7.</b>
                        
                         Feature: Seek
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.8" data-path="comms/internal/feature-end.html">
            
                
                    <a href="../../comms/internal/feature-end.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.8.</b>
                        
                         Feature: End
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.9" data-path="comms/internal/feature-timereport.html">
            
                
                    <a href="../../comms/internal/feature-timereport.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.9.</b>
                        
                         Feature: TimeReport
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.10" data-path="comms/internal/feature-playlist.html">
            
                
                    <a href="../../comms/internal/feature-playlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.10.</b>
                        
                         Feature: Playlist
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.11" data-path="comms/internal/feature-textitems.html">
            
                
                    <a href="../../comms/internal/feature-textitems.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.11.</b>
                        
                         Feature: Playlist.TextItems
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="comms/external/README.html">
            
                
                    <a href="../../comms/external/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         External API
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="impl/README.html">
            
                
                    <a href="../../impl/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Reference Implementations
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 55.55555555555556%;min-width: 51.851851851851855%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../../meta/README.html" title="This document" class="chapter done new-chapter" data-progress="1" style="left: 3.7037037037037037%;"></a>
    
        <a href="../../meta/compiling.html" title="Compiling" class="chapter done " data-progress="1.1" style="left: 7.407407407407407%;"></a>
    
        <a href="../../meta/conventions.html" title="Conventions" class="chapter done " data-progress="1.2" style="left: 11.11111111111111%;"></a>
    
        <a href="../../rationale/README.html" title="Rationale" class="chapter done new-chapter" data-progress="2" style="left: 14.814814814814815%;"></a>
    
        <a href="../../services/README.html" title="Services" class="chapter done new-chapter" data-progress="3" style="left: 18.51851851851852%;"></a>
    
        <a href="../../services/player.html" title="Player" class="chapter done " data-progress="3.1" style="left: 22.22222222222222%;"></a>
    
        <a href="../../services/playlist.html" title="Playlist" class="chapter done " data-progress="3.2" style="left: 25.925925925925927%;"></a>
    
        <a href="../../services/platform.html" title="Platform" class="chapter done " data-progress="3.3" style="left: 29.62962962962963%;"></a>
    
        <a href="../../services/tracklister.html" title="Track Lister" class="chapter done " data-progress="3.4" style="left: 33.333333333333336%;"></a>
    
        <a href="../../services/trackresolver.html" title="Track Resolver" class="chapter done " data-progress="3.5" style="left: 37.03703703703704%;"></a>
    
        <a href="../../services/client.html" title="Client" class="chapter done " data-progress="3.6" style="left: 40.74074074074074%;"></a>
    
        <a href="../../services/additional.html" title="Additional Services" class="chapter done " data-progress="3.7" style="left: 44.44444444444444%;"></a>
    
        <a href="../../comms/README.html" title="Inter-Service Communications" class="chapter done new-chapter" data-progress="4" style="left: 48.148148148148145%;"></a>
    
        <a href="../../comms/internal/README.html" title="Internal API" class="chapter done " data-progress="4.1" style="left: 51.851851851851855%;"></a>
    
        <a href="../../comms/internal/protocol.html" title="Protocol" class="chapter done " data-progress="4.1.1" style="left: 55.55555555555556%;"></a>
    
        <a href="../../comms/internal/features.html" title="Features" class="chapter  " data-progress="4.1.2" style="left: 59.25925925925926%;"></a>
    
        <a href="../../comms/internal/changes.html" title="API Changes" class="chapter  " data-progress="4.1.3" style="left: 62.96296296296296%;"></a>
    
        <a href="../../comms/internal/core.html" title="Core" class="chapter  " data-progress="4.1.4" style="left: 66.66666666666667%;"></a>
    
        <a href="../../comms/internal/feature-fileload.html" title="Feature: FileLoad" class="chapter  " data-progress="4.1.5" style="left: 70.37037037037037%;"></a>
    
        <a href="../../comms/internal/feature-playstop.html" title="Feature: PlayStop" class="chapter  " data-progress="4.1.6" style="left: 74.07407407407408%;"></a>
    
        <a href="../../comms/internal/feature-seek.html" title="Feature: Seek" class="chapter  " data-progress="4.1.7" style="left: 77.77777777777777%;"></a>
    
        <a href="../../comms/internal/feature-end.html" title="Feature: End" class="chapter  " data-progress="4.1.8" style="left: 81.48148148148148%;"></a>
    
        <a href="../../comms/internal/feature-timereport.html" title="Feature: TimeReport" class="chapter  " data-progress="4.1.9" style="left: 85.18518518518519%;"></a>
    
        <a href="../../comms/internal/feature-playlist.html" title="Feature: Playlist" class="chapter  " data-progress="4.1.10" style="left: 88.88888888888889%;"></a>
    
        <a href="../../comms/internal/feature-textitems.html" title="Feature: Playlist.TextItems" class="chapter  " data-progress="4.1.11" style="left: 92.5925925925926%;"></a>
    
        <a href="../../comms/external/README.html" title="External API" class="chapter  " data-progress="4.2" style="left: 96.29629629629629%;"></a>
    
        <a href="../../impl/README.html" title="Reference Implementations" class="chapter  new-chapter" data-progress="5" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_15">
                    
                        <h1 id="protocol">Protocol</h1>
<p>The BAPS3 Internal API sits atop a text-based protocol based upon
<a href="http://pubs.opengroup.org/onlinepubs/009604599/utilities/xcu_chap02.html" target="_blank">POSIX shell</a> conventions.</p>
<h2 id="rationale">Rationale</h2>
<p>We use a shell-style protocol because:</p>
<ul>
<li>It is lightweight and relatively easy to parse;</li>
<li>It is a good match for the command-and-arguments style of the BAPS3 API;</li>
<li>The shell style of escaping is convenient for escaping paths (especially on
Windows, where the single-quote syntax can avoid needing to escape every
backslash in a Windows path), which are common arguments to BAPS3 commands
(<code>load</code>, <code>enqueue</code>, and so on).</li>
</ul>
<p>A disadvantage is that it is impossible to perform a context-free splitting of
input into lines; the line-feed character could be escaped.  However, since the
usual transport used by the BAPS3 protocol is TCP, and most TCP libraries
provide unbuffered input in chunks which may be smaller or larger than one line,
we rarely need this luxury.</p>
<h2 id="encoding">Encoding</h2>
<p>API users <strong>must</strong> support the sending and receiving of all single-byte UTF-8
character codes (including, and especially, the subset overlapping with ASCII).</p>
<h2 id="quoting-and-escaping">Quoting and Escaping</h2>
<p>The majority of characters may be transmitted verbatim via the protocol.
However, in order to allow separation of protocol communications into the
<em>words</em> and <em>commands</em> defined below, BAPS3 must give special meaning to certain
characters.  This is done according to four <em>quote modes</em>, specified below.</p>
<p><strong>Note:</strong> In case of ambiguity, refer to the <a href="http://pubs.opengroup.org/onlinepubs/009604599/utilities/xcu_chap02.html" target="_blank">POSIX shell</a> quoting standards:
we follow that style of quoting with the exception of disallowing variable and
command interpolation (thus, backtick and dollar are not considered special).</p>
<h3 id="unquoted-mode">Unquoted mode</h3>
<p>A protocol tokeniser <strong>should</strong> start in <em>unquoted</em> mode.  In this mode:</p>
<ul>
<li>Any run of <em>whitespace characters</em> (for example, any character for which the
C function <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/isspace.html" target="_blank">isspace()</a> returns <em>true</em>) separates one word from the next;</li>
<li>A <em>line-feed</em> character separates one command from the next, and ends any
word preceding;</li>
<li>A single-quote character (<code>&#39;</code>) begins <em>single-quoted</em> mode;</li>
<li>A double-quote character (<code>&quot;</code>) begins <em>double-quoted</em> mode;</li>
<li>A backslash character (<code>\</code>) begins <em>escaped</em> mode;</li>
<li>Any other character is echoed verbatim.</li>
</ul>
<h3 id="single-quoted-mode">Single-quoted mode</h3>
<p>In single-quoted mode, only the single-quote character is treated specially, and
has the effect of returning to unquoted mode.</p>
<h3 id="double-quoted-mode">Double-quoted mode</h3>
<p>In double-quoted mode:</p>
<ul>
<li>A backslash character begins escaped mode;</li>
<li>A double-quote character begins unquoted mode;</li>
<li>Any other character is echoed verbatim.</li>
</ul>
<h3 id="escaped-mode">Escaped mode</h3>
<p>In escaped mode, any single character is treated verbatim; the mode then reverts
to that in which the backslash beginning escaped mode was read.</p>
<p>To allow implementations which escape single bytes instead of characters,
clients <strong>should not</strong> expect servers to backslash-escape multiple-byte
characters properly, and <strong>should</strong> instead use single-quoted or double-quoted
mode to escape these characters.</p>
<h2 id="words">Words</h2>
<p>The core element of the protocol is the <em>word</em>, which is a sequence of
zero or more characters delimited by any run of <em>unquoted</em> whitespace.</p>
<p><strong>Note:</strong> There is <em>no</em> limit on the number of quote mode transitions inside a
single word.  For example, <code>unquoted&quot;double&quot;unquoted&#39;single&#39;\ unquoted</code>
<strong>should</strong> be considered one word (albeit a pathological one).</p>
<h2 id="commands">Commands</h2>
<p>Each communication over the Internal API consists of a <em>command</em> of one or more
words.  The first, mandatory, word is the <em>command word</em> and unambiguously
identifies the command; any further words are <em>arguments</em> to that command.  In
this respect, the BAPS3 protocol perfectly mirrors shell usage.</p>
<p>Commands are divided into <em>requests</em> and <em>responses</em>.</p>
<h3 id="requests">Requests</h3>
<p><em>Requests</em> are the subset of valid commands that originate from an API client,
and instruct an API service.  Request command words <strong>should</strong> consist of one
or more <em>lowercase</em> ASCII characters, and <strong>may</strong> be quoted.</p>
<h3 id="responses">Responses</h3>
<p><em>Requests</em> are the subset of valid commands that originate from an API service,
and inform an API client.  Response command words <strong>should</strong> consist of one
or more <em>uppercase</em> ASCII characters, and <strong>may</strong> be quoted.</p>
<h3 id="examples">Examples</h3>
<p>The following are well-formed commands:</p>
<ul>
<li><code>stop</code></li>
<li><code>&quot;play&quot;</code></li>
<li><code>&#39;quit&#39;</code></li>
<li><code>enqueue file 0 /home/demo/music/test\ file.mp3</code></li>
<li><code>load &quot;/home/demo/music/test file.mp3&quot;</code></li>
<li><code>load &#39;C:\Users\Demo\Music\test file.mp3&#39;</code></li>
<li><code>load &quot;C:\\Users\\Demo\\Music\\test file.mp3&quot;</code></li>
<li><code>OHAI &#39;listmaster/playslave&#39;</code></li>
<li><code>FEATURES FileLoad PlayStop Seek End TimeReport</code></li>
</ul>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../../comms/internal/README.html" class="navigation navigation-prev " aria-label="Previous page: Internal API"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../comms/internal/features.html" class="navigation navigation-next " aria-label="Next page: Features"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
<script src="../../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
